!function(){function e(){try{let e={startTime:-1,size:-1,domPath:"",tag:""};const t=PerformanceObserver.supportedEntryTypes;if(!t||-1===t.indexOf("largest-contentful-paint"))return e;let o=new PerformanceObserver((e=>{}));o.observe({type:"largest-contentful-paint",buffered:!0});let r=o.takeRecords(),i=[];for(let e of r){let t=e.element;i.push({duration:e.duration,id:e.id,url:e.url,loadTime:Number(e.loadTime.toFixed(0)),renderTime:Number(Math.max(e.renderTime,e.loadTime).toFixed(0)),size:e.size,startTime:Number(e.startTime.toFixed(0)),tagName:t?t.tagName:"",className:t?t.className:"",domPath:t?n(t).join(" > "):"",tag:t?t.cloneNode(!1).outerHTML:""})}let a=i.pop()||{};return e.startTime=a.startTime||e.startTime,e.size=a.size||e.size,e.domPath=a.domPath||e.domPath,e.tag=a.tag||e.tag,e}catch(e){console.log("Failed getting largest contentful paint")}}function t(){try{if(function(){try{return window.self!==window.top}catch(e){return!0}}())return;let t={};performance.getEntriesByType("paint").forEach((function(e){t[e.name]=e.startTime}));const n=performance.getEntriesByType("navigation")[0],o=function(){try{let e=window.performance.getEntriesByType("navigation")[0],t=0;return e?{domainLookupTime:Number((e.domainLookupEnd-e.domainLookupStart).toFixed(t)),ttfb:Math.round(e.responseStart-e.requestStart),redirectionTime:Number((e.redirectEnd-e.redirectStart).toFixed(t)),serverConnectionTime:Number((e.connectEnd-e.connectStart).toFixed(t)),serverResponseTime:Number((e.responseEnd-e.requestStart).toFixed(t)),pageDownloadTime:Number((e.responseEnd-e.responseStart).toFixed(t)),domInteractiveTime:Number(e.domInteractive.toFixed(t)),domContentLoadedTime:Number(e.domContentLoadedEventStart.toFixed(t)),pageLoadTime:Number(e.loadEventStart.toFixed(t)),frontEndTime:Number((e.loadEventStart-e.responseEnd).toFixed(t)),backEndTime:Number(e.responseStart.toFixed(t))}:(e=window.performance.timing,{domainLookupTime:e.domainLookupEnd-e.domainLookupStart,redirectionTime:e.fetchStart-e.navigationStart,serverConnectionTime:e.connectEnd-e.connectStart,serverResponseTime:e.responseEnd-e.requestStart,pageDownloadTime:e.responseEnd-e.responseStart,domInteractiveTime:e.domInteractive-e.navigationStart,domContentLoadedTime:e.domContentLoadedEventStart-e.navigationStart,pageLoadTime:e.loadEventStart-e.navigationStart,frontEndTime:e.loadEventStart-e.responseEnd,backEndTime:e.responseStart-e.navigationStart,ttfb:e.responseStart-e.requestStart})}catch(e){return console.log("Failed getting navigation timings"),{}}}();return{title:window.document.title,onContentLoad:o.domContentLoadedTime||-1,onLoad:o.pageLoadTime||-1,_href:window.location.href,_dns:Math.round(n.domainLookupEnd-n.domainLookupStart)||-1,_ssl:Math.round(n.requestStart-n.secureConnectionStart)||-1,_timeToFirstByte:o.ttfb||-1,_largestContentfulPaint:e()||-1,_firstContentfulPaint:Math.round(t["first-contentful-paint"])||-1,_domInteractive:o.domInteractiveTime||-1}}catch(e){return console.log("Failed getting page timings",e),{}}}function n(e){let t=[];for(;null!=e.parentNode;){let n=e.nodeName.toLowerCase(),o=0,r=0;for(let t=0;t<e.parentNode.childNodes.length;t++){let n=e.parentNode.childNodes[t];if(n.nodeName==e.nodeName){if(n===e){o=r;break}r++}}e.hasAttribute("id")&&""!=e.id?t.unshift(n+"#"+e.id):r>1?t.unshift(n+":eq("+o+")"):t.unshift(n),e=e.parentNode}return t.slice(1)}function o(e){let t=[];for(;e&&1==e.nodeType;e=e.parentNode){let n=0;for(let t=e.previousSibling;t;t=t.previousSibling)1==t.nodeType&&t.tagName==e.tagName&&n++;let o=e.tagName.toLowerCase(),r=n?"["+(n+1)+"]":"";t.splice(0,0,o+r)}return t.length?"/"+t.join("/"):null}function r(e){let t=e.target;if(t){let n=[];const r=/test|qa|cy|play|sele|autom|name|id|browserup/i;for(let e of t.attributes)e.name.startsWith("data-")&&r.test(e.name)&&n.push(`${e.name}=${e.value.substring(0,50)}`);let i=n.join(","),a=(t.value||t.innerText).trim();a=a.length>50?a.substring(0,50):a;let d={name:t.getAttribute("name")||null,id:t.getAttribute("id")||null,className:t.getAttribute("class")||null,ariaLabel:t.getAttribute("aria-label")||null,tagName:t.tagName,event:e.type,role:t.getAttribute("role"),xpath:o(t),dataAttributes:i,form:t?.form?.name||null,content:a};Object.keys(d).forEach((e=>null==d[e]&&delete d[e])),b.push(d)}}function i(e,t){try{if(!t)return t;return new URL(t,e).href}catch(e){return console.error(e),t}}function a(e){return"webkitVideoDecodedByteCount"in e?e.webkitVideoDecodedByteCount:-1}function d(e){return"webkitAudioDecodedByteCount"in e?e.webkitAudioDecodedByteCount:-1}function s(e,t=document.body){const n=Array.from(t.querySelectorAll("*")).map((e=>e.shadowRoot)).filter(Boolean).map((t=>s(e,t)));return Array.from(t.querySelectorAll(e)).concat(n).flat()}function u(){try{let e=[];const t=s("video");for(let n of t){n.addEventListener("play",p),n.addEventListener("pause",p),n.addEventListener("stalled",(function(e){this.stallCount=this.stallCount?this.stallCount+1:1})),n.addEventListener("waiting",(function(e){this.waitingCount=this.waitingCount?this.waitingCount+1:1})),n.addEventListener("error",(function(e){this.errorCount=this.errorCount?this.errorCount+1:1}));let t=n.getVideoPlaybackQuality();if(0===n.querySelectorAll("source").length){if(l(n.src)){let o=c(n.src,n,t);e.push(o)}}else{let o=n.currentSrc;if(l(o)){let r=c(o,n,t);e.push(r)}}}return e}catch(e){return console.log(`Failed getting playback quality ${e}`,e),[]}}function l(e){return"string"==typeof e&&e.length>1}function c(e,t,n){return{_videoSRC:i(window.location,e),_videoBufferedPercent:m(t),_videoStallCount:t.stallCount||0,_videoDecodedByteCount:a(t),_videoWaitingCount:t.waitingCount||0,_videoErrorCount:t.errorCount||0,_videoDroppedFrames:n.droppedVideoFrames,_videoTotalFrames:n.totalVideoFrames,_videoAudioBytesDecoded:d(t)}}function m(e){try{const t=e.buffered,n=e.duration;if(0===n)return 0;const o=t.length?t.end(t.length-1):0,r=Math.round(o/n*100);return isNaN(r)?0:r}catch(e){return-1}}function f(){if(y)return;new Promise((function(e,n){w("page_complete",t()),p(),w("actions",b)})).then((function(){T.readyState!==WebSocket.CLOSED&&T.close()})),y=!0}function p(){const e=u();console.log(`Found ${e.length} videos per sendVideoData`),0!==e.length&&w("videos",e)}function g(){w("page_timings",t())}let v,b=[],h=100,y=!1,T=new WebSocket(("https:"===window.location.protocol?"wss://":"ws://")+window.location.host+"/BrowserUpData");function w(e,t){Object.keys(t).forEach((e=>void 0===t[e]?delete t[e]:{}));let n={operation:e,data:t};var o;(o=T,new Promise((e=>{o.readyState!==o.OPEN?o.addEventListener("open",(t=>{e(o)})):e()}))).then((t=>{console.log(`Sending ${e} data to proxy`),T.send(JSON.stringify(n))}))}T.onclose=e=>{1!=y&&(setTimeout(connectWebSocket,h),h=Math.min(1e4,2*h))},T.onopen=function(e){console.log("WebSocket connected"),h=50},window.browserUp?console.error("BrowserUp Double load Error!!!"):(function(){try{new PerformanceObserver((e=>{let t;for(const n of e.getEntries())"first-paint"===n.name&&(t=n.startTime.toFixed(0),w("page_timings",{_firstPaint:t}))})).observe({entryTypes:["paint"]})}catch(e){console.log("Failed to create observer for observeFirstPaint",e)}}(),function(){try{const e=PerformanceObserver.supportedEntryTypes;if(!e||-1===e.indexOf("first-input"))return;new PerformanceObserver((e=>{for(let t of e.getEntries())w("page_timings",{_firstInputDelay:Number((t.processingStart-t.startTime).toFixed(1))})})).observe({type:"first-input",buffered:!0})}catch(e){console.log("Failed to create observer for first input delay")}}(),function(){try{const e=PerformanceObserver.supportedEntryTypes;if(!e||-1===e.indexOf("layout-shift"))return;let t=0,n=0,o=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;new PerformanceObserver((e=>{for(let i of e.getEntries())i.hadRecentInput||((i.startTime-o>5e3||i.startTime-r>1e3)&&(o=i.startTime,n=0),r=i.startTime,n+=i.value,t=Math.max(t,n));w("page_timings",{_cumulativeLayoutShift:t})})).observe({type:"layout-shift",buffered:!0})}catch(e){console.log("Failed to create observer for cumulative layout shift")}}(),document.addEventListener("change",(function(e){r(e)}),!0),document.addEventListener("click",(function(e){r(e)}),!0),v=setInterval(p,15e3),window.addEventListener("load",p),window.addEventListener("load",g),window.addEventListener("click",g),window.addEventListener("beforeunload",f),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&f()})))}();
