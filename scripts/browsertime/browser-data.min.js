!function(){function t(){try{if(function t(){try{return window.self!==window.top}catch(e){return!0}}())return;let t={};performance.getEntriesByType("paint").forEach(function(e){t[e.name]=e.startTime});let n=performance.getEntriesByType("navigation")[0],o=function t(){try{let e=window.performance.getEntriesByType("navigation")[0];if(e)return{domainLookupTime:Number((e.domainLookupEnd-e.domainLookupStart).toFixed(0)),ttfb:Math.round(e.responseStart-e.requestStart),redirectionTime:Number((e.redirectEnd-e.redirectStart).toFixed(0)),serverConnectionTime:Number((e.connectEnd-e.connectStart).toFixed(0)),serverResponseTime:Number((e.responseEnd-e.requestStart).toFixed(0)),pageDownloadTime:Number((e.responseEnd-e.responseStart).toFixed(0)),domInteractiveTime:Number(e.domInteractive.toFixed(0)),domContentLoadedTime:Number(e.domContentLoadedEventStart.toFixed(0)),pageLoadTime:Number(e.loadEventStart.toFixed(0)),frontEndTime:Number((e.loadEventStart-e.responseEnd).toFixed(0)),backEndTime:Number(e.responseStart.toFixed(0))};return{domainLookupTime:(e=window.performance.timing).domainLookupEnd-e.domainLookupStart,redirectionTime:e.fetchStart-e.navigationStart,serverConnectionTime:e.connectEnd-e.connectStart,serverResponseTime:e.responseEnd-e.requestStart,pageDownloadTime:e.responseEnd-e.responseStart,domInteractiveTime:e.domInteractive-e.navigationStart,domContentLoadedTime:e.domContentLoadedEventStart-e.navigationStart,pageLoadTime:e.loadEventStart-e.navigationStart,frontEndTime:e.loadEventStart-e.responseEnd,backEndTime:e.responseStart-e.navigationStart,ttfb:e.responseStart-e.requestStart}}catch(n){return console.log("Failed getting navigation timings"),{}}}();return{title:window.document.title,onContentLoad:o.domContentLoadedTime||-1,onLoad:o.pageLoadTime||-1,_href:window.location.href,_dns:Math.round(n.domainLookupEnd-n.domainLookupStart)||-1,_ssl:Math.round(n.requestStart-n.secureConnectionStart)||-1,_timeToFirstByte:o.ttfb||-1,_largestContentfulPaint:function t(){try{let n={startTime:-1,size:-1,domPath:"",tag:""},o=PerformanceObserver.supportedEntryTypes;if(!o||-1===o.indexOf("largest-contentful-paint"))return n;let i=new PerformanceObserver(t=>{});i.observe({type:"largest-contentful-paint",buffered:!0});let r=i.takeRecords(),a=[];for(let d of r){let s=d.element;a.push({duration:d.duration,id:d.id,url:d.url,loadTime:Number(d.loadTime.toFixed(0)),renderTime:Number(Math.max(d.renderTime,d.loadTime).toFixed(0)),size:d.size,startTime:Number(d.startTime.toFixed(0)),tagName:s?s.tagName:"",className:s?s.className:"",domPath:s?e(s).join(" > "):"",tag:s?s.cloneNode(!1).outerHTML:""})}let l=a.pop()||{};return n.startTime=l.startTime||n.startTime,n.size=l.size||n.size,n.domPath=l.domPath||n.domPath,n.tag=l.tag||n.tag,n}catch(u){console.log("Failed getting largest contentful paint")}}()||-1,_firstContentfulPaint:Math.round(t["first-contentful-paint"])||-1,_domInteractive:o.domInteractiveTime||-1}}catch(i){return console.log("Failed getting page timings",i),{}}}function e(t){let e=[];for(;null!=t.parentNode;){let n=t.nodeName.toLowerCase(),o=0,i=0;for(let r=0;r<t.parentNode.childNodes.length;r++){let a=t.parentNode.childNodes[r];if(a.nodeName==t.nodeName){if(a===t){o=i;break}i++}}t.hasAttribute("id")&&""!=t.id?e.unshift(n+"#"+t.id):i>1?e.unshift(n+":eq("+o+")"):e.unshift(n),t=t.parentNode}return e.slice(1)}function n(t){let e=t.target;if(e){let n=[],o=/test|qa|cy|play|sele|autom|name|id|browserup/i;for(let i of e.attributes)i.name.startsWith("data-")&&o.test(i.name)&&n.push(`${i.name}=${i.value.substring(0,50)}`);let r=n.join(","),a=(e.value||e.innerText).trim();a=a.length>50?a.substring(0,50):a;let d={name:e.getAttribute("name")||null,id:e.getAttribute("id")||null,className:e.getAttribute("class")||null,ariaLabel:e.getAttribute("aria-label")||null,tagName:e.tagName,event:t.type,role:e.getAttribute("role"),xpath:function t(e){let n=[];for(;e&&1==e.nodeType;e=e.parentNode){let o=0;for(let i=e.previousSibling;i;i=i.previousSibling)1==i.nodeType&&i.tagName==e.tagName&&o++;let r=e.tagName.toLowerCase(),a=o?"["+(o+1)+"]":"";n.splice(0,0,r+a)}return n.length?"/"+n.join("/"):null}(e),dataAttributes:r,form:e?.form?.name||null,content:a};Object.keys(d).forEach(t=>null==d[t]&&delete d[t]),s.push(d)}}function o(t){return"string"==typeof t&&t.length>1}function i(t,e,n){var o,i;return{_videoSRC:function t(e,n){try{if(!n)return n;let o=new URL(n,e);return o.href}catch(i){return console.error(i),n}}(window.location,t),_videoBufferedPercent:function t(e){try{let n=e.buffered,o=e.duration;if(0===o)return 0;let i=n.length?n.end(n.length-1):0,r=Math.round(i/o*100);return isNaN(r)?0:r}catch(a){return -1}}(e),_videoStallCount:e.stallCount||0,_videoDecodedByteCount:"webkitVideoDecodedByteCount"in(o=e)?o.webkitVideoDecodedByteCount:-1,_videoWaitingCount:e.waitingCount||0,_videoErrorCount:e.errorCount||0,_videoDroppedFrames:n.droppedVideoFrames,_videoTotalFrames:n.totalVideoFrames,_videoAudioBytesDecoded:"webkitAudioDecodedByteCount"in(i=e)?i.webkitAudioDecodedByteCount:-1}}function r(){if(!c)new Promise(function(e,n){m("page_complete",t()),a(),m("actions",s)}).then(function(){f.readyState!==WebSocket.CLOSED&&f.close()}),c=!0}function a(){let t=function t(){try{let e=[],n=function t(e,n=document.body){let o=Array.from(n.querySelectorAll("*")).map(t=>t.shadowRoot).filter(Boolean),i=o.map(n=>t(e,n)),r=Array.from(n.querySelectorAll(e));return r.concat(i).flat()}("video");for(let r of n){r.addEventListener("play",a),r.addEventListener("pause",a),r.addEventListener("stalled",function(t){this.stallCount=this.stallCount?this.stallCount+1:1}),r.addEventListener("waiting",function(t){this.waitingCount=this.waitingCount?this.waitingCount+1:1}),r.addEventListener("error",function(t){this.errorCount=this.errorCount?this.errorCount+1:1});let d=r.getVideoPlaybackQuality(),s=r.querySelectorAll("source");if(0===s.length){if(o(r.src)){let l=i(r.src,r,d);e.push(l)}}else for(let u of s){console.log(u);let c=u.src;if(o(c)){let f=i(c,r,d);e.push(f)}}}return console.log("VIDEOS --->",e),e}catch(m){return console.log(`Failed getting playback quality ${m}`,m),[]}}();console.log(`Found ${t.length} videos per sendVideoData`),0!==t.length&&m("videos",t)}function d(){m("page_timings",t())}let s=[],l,u=100,c=!1,f=new WebSocket(("https:"===window.location.protocol?"wss://":"ws://")+window.location.host+"/BrowserUpData");function m(t,e){var n;Object.keys(e).forEach(t=>void 0===e[t]?delete e[t]:{});let o={operation:t,data:e};(n=f,new Promise(t=>{n.readyState!==n.OPEN?n.addEventListener("open",e=>{t(n)}):t()})).then(e=>{console.log(`Sending ${t} data to proxy`),f.send(JSON.stringify(o))})}f.onclose=t=>{!0!=c&&(setTimeout(connectWebSocket,u),u=Math.min(1e4,2*u))},f.onopen=function(t){console.log("WebSocket connected"),u=50},!function t(){if(window.browserUp){console.error("BrowserUp Double load Error!!!");return}!function t(){try{let e=new PerformanceObserver(t=>{let e;for(let n of t.getEntries())"first-paint"===n.name&&(e=n.startTime.toFixed(0),m("page_timings",{_firstPaint:e}))});e.observe({entryTypes:["paint"]})}catch(n){console.log("Failed to create observer for observeFirstPaint",n)}}(),function t(){try{let e=PerformanceObserver.supportedEntryTypes;if(!e||-1===e.indexOf("first-input"))return;new PerformanceObserver(t=>{for(let e of t.getEntries()){let n=Number((e.processingStart-e.startTime).toFixed(1));m("page_timings",{_firstInputDelay:n})}}).observe({type:"first-input",buffered:!0})}catch(n){console.log("Failed to create observer for first input delay")}}(),function t(){try{let e=PerformanceObserver.supportedEntryTypes;if(!e||-1===e.indexOf("layout-shift"))return;let n=0,o=0,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=new PerformanceObserver(t=>{for(let e of t.getEntries())!e.hadRecentInput&&((e.startTime-i>5e3||e.startTime-r>1e3)&&(i=e.startTime,o=0),r=e.startTime,o+=e.value,n=Math.max(n,o));m("page_timings",{_cumulativeLayoutShift:n})});a.observe({type:"layout-shift",buffered:!0})}catch(d){console.log("Failed to create observer for cumulative layout shift")}}(),document.addEventListener("change",function(t){n(t)},!0),document.addEventListener("click",function(t){n(t)},!0),l=setInterval(a,15e3),window.addEventListener("load",a),window.addEventListener("load",d),window.addEventListener("click",d),window.addEventListener("beforeunload",r),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&r()})}()}();
