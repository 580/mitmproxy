function inIframe(){try{return window.self!==window.top}catch(e){return!0}}function firstPaint(){let e=window.performance,t=e.timing,n=e.getEntriesByType("paint");if(n.length>0)for(let e of n)if("first-paint"===e.name)return Number(e.startTime.toFixed(0));if(t.timeToNonBlankPaint)return Number((t.timeToNonBlankPaint-t.navigationStart).toFixed(0))}function cumulativeLayoutShift(){let e=PerformanceObserver.supportedEntryTypes;if(!e||-1===e.indexOf("layout-shift"))return;let t=0,n=0,o=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=new PerformanceObserver((e=>{}));i.observe({type:"layout-shift",buffered:!0});let a=i.takeRecords();for(let e of a)e.hadRecentInput||((e.startTime-o>5e3||e.startTime-r>1e3)&&(o=e.startTime,n=0),r=e.startTime,n+=e.value,t=Math.max(t,n));return t}function largestContentFullPaint(){function e(e){let t=[];for(;null!=e.parentNode;){let n=0,o=0;for(let t=0;t<e.parentNode.childNodes.length;t++){let r=e.parentNode.childNodes[t];r.nodeName==e.nodeName&&(r===e&&(o=n),n++)}e.hasAttribute&&e.hasAttribute("id")&&""!=e.id?t.unshift(e.nodeName.toLowerCase()+"#"+e.id):n>1?t.unshift(e.nodeName.toLowerCase()+":eq("+o+")"):t.unshift(e.nodeName.toLowerCase()),e=e.parentNode}return t.slice(1)}let t=PerformanceObserver.supportedEntryTypes;if(!t||-1===t.indexOf("largest-contentful-paint"))return;let n=new PerformanceObserver((e=>{}));n.observe({type:"largest-contentful-paint",buffered:!0});let o=n.takeRecords(),r=[];for(let t of o){let n=t.element;r.push({duration:t.duration,id:t.id,url:t.url,loadTime:Number(t.loadTime.toFixed(0)),renderTime:Number(Math.max(t.renderTime,t.loadTime).toFixed(0)),size:t.size,startTime:Number(t.startTime.toFixed(0)),tagName:n?n.tagName:"",className:n?n.className:"",domPath:n?e(n).join(" > "):"",tag:n?n.cloneNode(!1).outerHTML:""})}return r}function navTimings(){let e=window.performance.getEntriesByType("navigation")[0];return e?{domainLookupTime:Number((e.domainLookupEnd-e.domainLookupStart).toFixed(0)),ttfb:Math.round(e.responseStart-e.requestStart),redirectionTime:Number((e.redirectEnd-e.redirectStart).toFixed(0)),serverConnectionTime:Number((e.connectEnd-e.connectStart).toFixed(0)),serverResponseTime:Number((e.responseEnd-e.requestStart).toFixed(0)),pageDownloadTime:Number((e.responseEnd-e.responseStart).toFixed(0)),domInteractiveTime:Number(e.domInteractive.toFixed(0)),domContentLoadedTime:Number(e.domContentLoadedEventStart.toFixed(0)),pageLoadTime:Number(e.loadEventStart.toFixed(0)),frontEndTime:Number((e.loadEventStart-e.responseEnd).toFixed(0)),backEndTime:Number(e.responseStart.toFixed(0))}:(e=window.performance.timing,{domainLookupTime:e.domainLookupEnd-e.domainLookupStart,redirectionTime:e.fetchStart-e.navigationStart,serverConnectionTime:e.connectEnd-e.connectStart,serverResponseTime:e.responseEnd-e.requestStart,pageDownloadTime:e.responseEnd-e.responseStart,domInteractiveTime:e.domInteractive-e.navigationStart,domContentLoadedTime:e.domContentLoadedEventStart-e.navigationStart,pageLoadTime:e.loadEventStart-e.navigationStart,frontEndTime:e.loadEventStart-e.responseEnd,backEndTime:e.responseStart-e.navigationStart,ttfb:e.responseStart-e.requestStart})}function firstPaint(){let e=window.performance,t=e.timing,n=e.getEntriesByType("paint");if(n.length>0)for(let e of n)if("first-paint"===e.name)return Number(e.startTime.toFixed(0));if(t.timeToNonBlankPaint)return Number((t.timeToNonBlankPaint-t.navigationStart).toFixed(0))}function postPerf(){if(inIframe())return;var e={};performance.getEntriesByType("paint").forEach((function(t){e[t.name]=t.startTime}));var t=performance.getEntriesByType("navigation")[0];n=navTimings();let o=n.domContentLoadedTime,r=n.pageLoadTime,i=n.ttfb,a=Math.round(e["first-contentful-paint"]),d=n.domInteractiveTime,s=firstPaint(),m=largestContentFullPaint(),u=cumulativeLayoutShift(),l=Math.round(t.domainLookupEnd-t.domainLookupStart),c=Math.round(t.requestStart-t.secureConnectionStart),f=new FormData;var p={title:window.document.title,onContentLoad:o,onLoad:r,_href:window.location.href,_dns:l,_ssl:c,_timeToFirstByte:i,_cumulativeLayoutShift:u,_largestContentFullPaint:m,_firstPaint:s,_domInteractive:d,_firstContentfulPaint:a};Object.keys(p).forEach((e=>void 0===p[e]?delete p[e]:{})),console.log(p),f.append("pageTimings",JSON.stringify(p)),"sendBeacon"in navigator&&(console.log("----\x3e Sendbeacon---"),navigator.sendBeacon("http://localhost:8088/har/page_timings",f)||console.error("BrowserUpProxy sendbeacon page_timings error"))}window.addEventListener("load",postPerf),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&(console.log("----\x3e Page change---"),"sendBeacon"in navigator&&navigator.sendBeacon("http://localhost:8088/har/page?title=",{}))}));
